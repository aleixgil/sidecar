<?php

namespace Revo\Sidecar\Widgets;

abstract class Widget
{
    public $model;
    public $onTable = null;

    public $title;
    public $field;
    public $display = 'bigNumber';
    public $displayFrom = null;

    public static function make($field, $title = null)
    {
        $panel = (new static);
        $panel->field = $field;
        $panel->title = $title ?? __(config('sidecar.translationsPrefix').$field);
        return $panel;
    }

    public function onTable($table) : self
    {
        $this->onTable = $table;
        return $this;
    }

    public function displayWith($display) : self {
        $this->display = $display;
        return $this;
    }

    public function getSelectField($groupBy = null) {
        return null;
    }

    public function getValue($row) : string
    {
        return "--";
    }

    public function getTitle() : string
    {
        return $this->title;
    }

    public function displayFrom($from) : self
    {
        $this->displayFrom = $from;
        return $this;
    }

    public function getDisplayCss() : string
    {
        if($this->displayFrom){
            return " hidden {$this->displayFrom}:block";
        }
        return '';
    }

    public function render($row) : string
    {
        return view("sidecar::widgets.{$this->display}",[
            'value' => $this->getValue($row),
            'title' => $this->getTitle(),
            'displayCss' => $this->getDisplayCss()
        ])->render();
    }

    public function fullField() : string {
        return $this->databaseTableFull() .'.'.$this->field;
    }

    public function databaseTable(): string {
        return $this->onTable ?? (new $this->model)->getTable();
    }

    public function databaseTableFull() : string {
        return config('database.connections.mysql.prefix') . $this->databaseTable();
    }
}